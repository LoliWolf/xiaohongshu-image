version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: xiaohongshu-api
    ports:
      - "31006:8080"
    environment:
      - SERVER_PORT=8080
      - SERVER_MODE=debug
      - NACOS_ADDR=${NACOS_ADDR}
      - NACOS_PORT=${NACOS_PORT:-8848}
      - NACOS_NAMESPACE=${NACOS_NAMESPACE:-public}
      - NACOS_GROUP=${NACOS_GROUP:-DEFAULT_GROUP}
      - NACOS_DATA_ID=${NACOS_DATA_ID:-xiaohongshu-image}
      - NACOS_USERNAME=${NACOS_USERNAME}
      - NACOS_PASSWORD=${NACOS_PASSWORD}
      - NACOS_LOG_DIR=${NACOS_LOG_DIR:-/tmp/nacos/log}
      - NACOS_LOG_LEVEL=${NACOS_LOG_LEVEL:-info}
    networks:
      - xiaohongshu-network
    restart: unless-stopped

  worker:
    build:
      context: .
      dockerfile: Dockerfile.worker
    container_name: xiaohongshu-worker
    environment:
      - SERVER_MODE=debug
      - NACOS_ADDR=${NACOS_ADDR}
      - NACOS_PORT=${NACOS_PORT:-8848}
      - NACOS_NAMESPACE=${NACOS_NAMESPACE:-public}
      - NACOS_GROUP=${NACOS_GROUP:-DEFAULT_GROUP}
      - NACOS_DATA_ID=${NACOS_DATA_ID:-xiaohongshu-image}
      - NACOS_USERNAME=${NACOS_USERNAME}
      - NACOS_PASSWORD=${NACOS_PASSWORD}
      - NACOS_LOG_DIR=${NACOS_LOG_DIR:-/tmp/nacos/log}
      - NACOS_LOG_LEVEL=${NACOS_LOG_LEVEL:-info}
    networks:
      - xiaohongshu-network
    restart: unless-stopped

  web:
    build:
      context: ./web
      dockerfile: Dockerfile
    container_name: xiaohongshu-web
    ports:
      - "31007:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:31006
    networks:
      - xiaohongshu-network
    restart: unless-stopped

networks:
  xiaohongshu-network:
    driver: bridge
